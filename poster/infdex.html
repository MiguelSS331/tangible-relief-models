<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tangible Relief — Interactive Dashboard Poster</title>
  <meta name="theme-color" content="#7c0a02" />
  <style>
    :root{
      --bg:#f7f3e8; --ink:#1b1f23; --muted:#5b646e; --card:#ffffff; --grid:#e6e0d4;
      --accent:#7c0a02; --accent2:#0f5132; --radius:16px; --shadow:0 10px 30px rgba(27,31,35,.08);
      --tl-x:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:400 16px/1.55 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}

    /* animated topo background */
    .bg{position:fixed;inset:-10vmax;z-index:-1;opacity:.8}
    .bg svg{position:absolute;width:160%;height:160%;left:-30%;top:-30%}
    .bg .paper{fill:url(#paperGrad)}
    .bg .contour{fill:none;stroke:#d9d3c7;stroke-width:1;stroke-dasharray:8 10;animation:dash 60s linear infinite}
    @keyframes dash{from{stroke-dashoffset:0}to{stroke-dashoffset:600}}
    @keyframes slowY{from{transform:translateY(0)}to{transform:translateY(-40px)}}
    @keyframes slowX{from{transform:translateX(0)}to{transform:translateX(40px)}}

    header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.9);backdrop-filter:blur(8px) saturate(130%);border-bottom:1px solid var(--grid)}
    .bar{max-width:980px;margin:auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:center}
    .brand{display:flex;gap:10px;align-items:baseline;font-weight:900;letter-spacing:.2px}
    .brand .title{font-size:20px;color:var(--accent)}
    .brand .sub{font-size:13px;color:var(--muted);border:1px solid var(--grid);border-radius:999px;padding:4px 10px}

    main{max-width:980px;margin:auto;padding:16px}

    /* KPIs */
    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:12px 0}
    @media(min-width:740px){.kpis{grid-template-columns:repeat(4,1fr)}}
    .kpi{background:var(--card);border:1px solid var(--grid);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
    .kpi h3{margin:0 0 6px;font-size:12px;letter-spacing:.06em;text-transform:uppercase;color:var(--muted)}
    .kpi .num{font-size:22px;font-weight:900;letter-spacing:.3px;color:var(--ink);display:inline-block;transform:translateY(8px) scale(.98);opacity:.15;transition:transform .6s,opacity .6s}

    /* layout */
    .grid{display:grid;gap:14px;margin:14px 0}
    @media(min-width:900px){.grid{grid-template-columns:repeat(12,1fr)}}
    .panel{background:var(--card);border:1px solid var(--grid);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .panel h2{margin:0 0 8px;font-size:18px;color:var(--accent)}
    .panel .eyebrow{font-size:12px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted)}
    .hero{display:grid;gap:8px}
    .lede{margin:0;color:var(--muted)}

    /* timeline */
    .timeline{position:relative;padding:6px 0 6px calc(var(--tl-x) + 18px);--prog:0;--tlh:400px}
    .timeline:before{content:"";position:absolute;left:var(--tl-x);top:0;bottom:0;width:3px;border-radius:2px;background:linear-gradient(var(--accent2),var(--accent))}
    .timeline .tracker{position:absolute;left:calc(var(--tl-x) - 7px);top:0;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 4px #f3e8e8;transform:translateY(calc(var(--prog) * (var(--tlh) - 14px)))}
    .timeline .fill{position:absolute;left:var(--tl-x);top:0;width:3px;height:calc(var(--prog) * var(--tlh));background:linear-gradient(var(--accent2),var(--accent));border-radius:2px}
    .step{position:relative;margin:12px 0;padding-left:6px;opacity:0;transform:translateY(16px);transition:opacity .6s,transform .6s}
    .step.show{opacity:1;transform:none}
    .step .meta{color:var(--muted);font-size:12px}

    /* tabs */
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
    .tab{background:#f2e8e6;border:1px solid var(--grid);padding:6px 10px;border-radius:999px;font-weight:700;color:var(--accent);cursor:pointer}
    .tab[aria-selected="true"]{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border-color:transparent}
    .tabview{margin-top:8px;display:grid;gap:8px}
    .tabview img{width:100%;border-radius:12px;border:1px solid var(--grid)}

    .bullets{margin:8px 0 0;padding:0 0 0 18px}
    .bullets li{margin:6px 0}

    /* techniques table */
    .table{display:grid;grid-template-columns:1fr;gap:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;border:1px dashed var(--grid);border-radius:12px;padding:10px}
    .row h4{margin:0;color:var(--ink)}
    .row p{margin:0;color:var(--muted);font-size:14px}

    /* figure */
    figure{margin:10px 0}
    figure img{width:100%;display:block;border-radius:12px;border:1px solid var(--grid)}
    figure figcaption{margin-top:6px;color:var(--muted);font-size:12px}

    /* gallery grid */
    .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
    @media(min-width:760px){.gallery{grid-template-columns:repeat(3,1fr)}}
    .thumb{margin:0;border:1px solid var(--grid);border-radius:12px;background:#fff;overflow:hidden;cursor:zoom-in;box-shadow:var(--shadow)}
    .thumb img{display:block;width:100%;height:auto}

    /* lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:999}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:86vh;border-radius:12px}
    .lb-nav{position:absolute;inset:auto 0 18px 0;display:flex;justify-content:center;gap:10px}
    .lb-btn{appearance:none;border:1px solid #ffffff55;background:#ffffff10;color:#fff;padding:8px 12px;border-radius:999px;font-weight:800}
    .lb-close{position:absolute;top:14px;right:14px}

    footer{margin:0;padding:24px 16px;background:linear-gradient(180deg,rgba(124,10,2,.06),rgba(15,81,50,.06) 60%,transparent 100%);border-top:1px solid var(--grid)}
    .foot{max-width:980px;margin:auto;text-align:center;color:var(--muted);font-size:13px;line-height:1.6}
    .foot .row{display:flex;flex-wrap:wrap;gap:6px 10px;justify-content:center;margin-top:6px}
    .tag{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid var(--grid);border-radius:999px;background:#fff;color:var(--ink);font-weight:600}

    .parallax{will-change:transform}
  </style>
</head>
<body>
  <!-- animated topo background -->
  <div class="bg" aria-hidden="true">
    <svg viewBox="0 0 1000 700">
      <defs>
        <linearGradient id="paperGrad" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" stop-color="#faf7ef"/><stop offset="100%" stop-color="#f5efe3"/>
        </linearGradient>
      </defs>
      <rect class="paper" x="0" y="0" width="1000" height="700"/>
      <g class="layer1 parallax" style="animation:slowY 28s ease-in-out infinite alternate">
        <path class="contour" d="M0,600 C120,560 240,640 360,600 C480,560 600,640 720,600 C840,560 920,630 1000,610"/>
        <path class="contour" d="M0,540 C120,500 240,580 360,540 C480,500 600,580 720,540 C840,500 920,570 1000,550"/>
      </g>
      <g class="layer2 parallax" style="animation:slowX 36s ease-in-out infinite alternate">
        <path class="contour" d="M0,420 C140,390 260,460 380,430 C500,400 620,470 760,430 C880,400 940,450 1000,440"/>
        <path class="contour" d="M0,370 C140,340 260,410 380,380 C500,350 620,420 760,380 C880,350 940,400 1000,390"/>
      </g>
      <g class="layer3 parallax" style="animation:slowY 44s ease-in-out infinite alternate-reverse">
        <path class="contour" d="M0,260 C120,230 240,300 360,270 C480,240 600,310 720,270 C840,240 920,290 1000,280"/>
      </g>
    </svg>
  </div>

  <header>
    <div class="bar">
      <div class="brand">
        <span class="title">Tangible Relief · Landscape Models</span>
        <span class="sub">Cartography M.Sc. — field seminar handout</span>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="panel hero">
      <p class="eyebrow">What is a relief model?</p>
      <h2>A physical 3D representation of terrain derived from elevation data</h2>
      <p class="lede">Readable by touch and sight; this dashboard-style handout is optimised for phones.</p>

      <div class="kpis" id="kpis">
        <div class="kpi"><h3>Typical scale</h3><div class="num" data-kind="scale">1:00,000</div></div>
        <div class="kpi"><h3>Z exaggeration</h3><div class="num" data-kind="z">1.0×</div></div>
        <div class="kpi"><h3>Layer height</h3><div class="num" data-kind="layer">0.00 mm</div></div>
        <div class="kpi"><h3>Print time</h3><div class="num" data-kind="time">0 h</div></div>
      </div>
    </section>

    <section class="grid">
      <!-- 01 HISTORY -->
      <article class="panel" style="grid-column:1/-1">
        <p class="eyebrow">01 · Historical Overview</p>
        <h2>From rice maps to rapid prototyping</h2>
        <div class="timeline" id="hist">
          <div class="fill" aria-hidden="true"></div>
          <div class="tracker" aria-hidden="true"></div>

          <div class="step"><h3>ca. 210 BCE — Xi’an, China</h3><p class="meta"><b>Terracotta Army Pit</b>: life-sized terracotta soldiers in battle formation — artistic rather than scientific models.</p></div>
          <div class="step"><h3>32 CE — Ma Yuan (Han dynasty)</h3><p class="meta">Raised-relief map made of <b>rice</b>, representing valleys and mountains.</p></div>
          <div class="step"><h3>420–479 CE — Xie Zhuang (Liu Song dynasty)</h3><p class="meta">Wooden raised-relief map of provinces, assembled like a jigsaw puzzle (~<b>0.93 m²</b>).</p></div>
          <div class="step"><h3>11th–12th c. — Shen Kuo / Huang Shang</h3><p class="meta">Models from wood, sawdust, beeswax, wheat paste; or sticky clay; some were foldable/portable.</p></div>
          <div class="step"><h3>14th century — Ibn Battuta</h3><p class="meta">Observed a raised-relief map in <b>Gibraltar</b>; later sources forgot these precedents.</p></div>
          <div class="step"><h3>1510 CE — Paul Dox (Europe)</h3><p class="meta">First European raised-relief map: 3D wooden model of <b>Kufstein</b> and the eastern Alps.</p></div>
          <div class="step"><h3>16th century — Venice</h3><p class="meta">~<b>200 models</b> created to depict Venetian Doges’ territories in the Levant; Venice becomes a hub.</p></div>
          <div class="step"><h3>1752–1833 — Joachim Eugen Müller</h3><p class="meta">Large terrain model of the <b>Swiss Alps</b>, basis for <em>Atlas Suisse</em>.</p></div>
          <div class="step"><h3>Late 19th c — Switzerland</h3><p class="meta">First peak of terrain modelling, driven by <b>contour maps</b>, <b>photography</b>, and <b>alpinism</b>.</p></div>
          <div class="step"><h3>Late 19th — Pantograph & Wenschow</h3><p class="meta"><b>Pantograph milling</b> and <b>die-stamped paper moulds</b> enable mass production.</p></div>
          <div class="step"><h3>Post-WWII — Vacuum forming</h3><p class="meta"><b>Plastic sheets</b> printed with maps → heated & vacuum-formed; cheap, fast, still used.</p></div>
          <div class="step"><h3>Recent — Computer-controlled 3D printing</h3><p class="meta"><b>Rapid prototyping</b> produces terrain models directly; <b>post-painting</b> developed.</p></div>
        </div>
      </article>

      <!-- 02 TYPES & APPLICATIONS -->
      <article class="panel" style="grid-column:1/-1">
        <p class="eyebrow">02 · Types & Applications</p>
        <h2>Where relief models shine</h2>
        <div class="tabs" id="tabs"></div>
        <div class="tabview" id="tabview"></div>
      </article>

      <!-- 03 TECHNIQUES (UPDATED TEXT + GALLERY) -->
      <article class="panel" style="grid-column:1/-1">
        <p class="eyebrow">03 · Production Techniques</p>
        <h2>Relief model methods — advantages & trade-offs</h2>

        <p class="lede" style="margin-top:4px">
          Relief models can be produced through a wide range of techniques, each representing specific advantages, limitations and costs.
          Traditional methods rely on craftsmanship with wood, bronze or plaster, while modern ones use DEM data, rapid prototyping and 3D printing.
        </p>

        <!-- Traditional -->
        <h3 style="margin:10px 0 6px;color:var(--accent2)">Traditional techniques</h3>
        <div class="table">
          <div class="row">
            <div><h4>Wood carving / laminated wood</h4></div>
            <div><p>Handcrafted from a wood block or laminated layers. <b>+ Durable, fine detail</b>. <b>− Very heavy; long production time</b>.</p></div>
          </div>
          <div class="row">
            <div><h4>Bronze casting</h4></div>
            <div><p>Clay/wax model → mould → bronze pour. <b>+ Extremely durable & prestigious</b>. <b>− Expensive, heavy, needs space</b>.</p></div>
          </div>
          <div class="row">
            <div><h4>Plaster casting</h4></div>
            <div><p>Negative mould (clay/wax/wood) filled with plaster. <b>+ Good for small series</b>. <b>− Fragile and relatively heavy</b>.</p></div>
          </div>
          <div class="row">
            <div><h4>Vacuum forming</h4></div>
            <div><p>Heated plastic sheet is vacuum-pulled over a solid terrain mould → lightweight shell. <b>+ Cheap & fast</b>. <b>− Sheet thins; can age and crack</b>. Examples: WWII portable relief maps.</p></div>
          </div>
        </div>

        <!-- Modern -->
        <h3 style="margin:14px 0 6px;color:var(--accent2)">Modern techniques</h3>
        <div class="table">
          <div class="row">
            <div><h4>Solid Terrain Modeling (CNC, subtractive)</h4></div>
            <div><p>DEM → toolpaths → CNC mills foam/wood/acrylic layer-by-layer. Smooth surfaces; limited by tool access.</p></div>
          </div>
          <div class="row">
            <div><h4>3D printing (additive)</h4></div>
            <div><p>Plastic or resin deposited layer-by-layer from DEM/mesh. Highly repeatable & flexible; constrained by build volume/time.</p></div>
          </div>
          <div class="row">
            <div><h4>Foam models</h4></div>
            <div><p>CNC or laser-cut; sheets at contour intervals stacked (LOM) or carved from a block.</p></div>
          </div>
          <div class="row">
            <div><h4>Hybrid methods</h4></div>
            <div><p>SLA / stereolithography, projection-mapped models, mixed printed parts with hand finishing.</p></div>
          </div>
        </div>

        <!-- Technique gallery 3a–3i -->
        <h3 style="margin:14px 0 6px;color:var(--accent2)">Technique gallery</h3>
        <p class="lede" style="margin:0 0 8px">Examples for each technique (tap to zoom):</p>
        <div class="gallery" id="ptGallery">
          <figure class="thumb" data-idx="0">
            <img src="3a.jpeg" alt="Wood carving / laminated wood">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3a · Wood carving / laminated wood</figcaption>
          </figure>
          <figure class="thumb" data-idx="1">
            <img src="3b.jpeg" alt="Bronze casting">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3b · Bronze casting</figcaption>
          </figure>
          <figure class="thumb" data-idx="2">
            <img src="3c.jpeg" alt="Plaster casting">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3c · Plaster casting</figcaption>
          </figure>
          <figure class="thumb" data-idx="3">
            <img src="3d.jpeg" alt="Vacuum forming — final shell">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3d · Vacuum forming (shell)</figcaption>
          </figure>
          <figure class="thumb" data-idx="4">
            <img src="3e.jpeg" alt="CNC milling — subtractive">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3e · CNC milling (subtractive)</figcaption>
          </figure>
          <figure class="thumb" data-idx="5">
            <img src="3f.jpeg" alt="3D printing — additive">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3f · 3D printing (additive)</figcaption>
          </figure>
          <figure class="thumb" data-idx="6">
            <img src="3g.jpeg" alt="Foam models — stacked contours">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3g · Foam models (stacked contours)</figcaption>
          </figure>
          <figure class="thumb" data-idx="7">
            <img src="3h.jpeg" alt="Hybrid methods — SLA / projection">
            <figcaption style="padding:6px 8px;color:var(--muted);font-size:12px">3h · Hybrid (SLA / projection)</figcaption>
          </figure>

        </div>
      </article> <!-- ✅ закрыл третью секцию -->

      <!-- 04 WORKFLOW -->
      <article class="panel" style="grid-column:1/-1" id="workflow">
        <p class="eyebrow">04 · 3D Printing Workflow</p>
        <h2>From DEM to painted model</h2>
        <div class="kpis" id="kpi2">
          <div class="kpi"><h3>Layer height</h3><div class="num" data-kind="layer">0.00 mm</div></div>
          <div class="kpi"><h3>Infill</h3><div class="num" data-kind="infill">0%</div></div>
          <div class="kpi"><h3>Walls</h3><div class="num" data-kind="walls">0</div></div>
          <div class="kpi"><h3>Print time</h3><div class="num" data-kind="time">0 h</div></div>
        </div>

        <figure><img src="pic1.png" alt="Cropping DEM"><figcaption><b>Step 1 — DEM.</b> Start with a Digital Elevation Model (satellite/LiDAR). Crop the exact area; smaller files → faster prints.</figcaption></figure>
        <figure><img src="pic2.png" alt="Terrain mesh"><figcaption><b>Step 2 — Model.</b> Import DEM → 3D surface; set scales; mild Z-exaggeration; export <b>STL</b>.</figcaption></figure>
        <figure><img src="pic3.png" alt="3D printing"><figcaption><b>Step 3 — Print.</b> Slice STL; tune layer height, speed, infill. FDM is common and reliable.</figcaption></figure>
        <figure><img src="pic4.png" alt="Painted model"><figcaption><b>Step 4 — Post-processing.</b> Remove supports, sand, paint/varnish.</figcaption></figure>
      </article>
    </section>

    <footer>
      <div class="foot">
        <div class="row" aria-label="Authors">
          <span class="tag">Martínez Solano Miguel Ángel</span>
          <span class="tag">Yi-Ru</span>
          <span class="tag">Shelegina Anna</span>
          <span class="tag">Kiseleva Agata</span>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // KPI animations (добавил infill и walls + финальные значения)
    const mapTargets = {
      scale:{from:100000,to:50000,fmt:v=>`1:${Math.round(v).toLocaleString()}`,dur:1200},
      z:{from:1.0,to:1.5,fmt:v=>`${v.toFixed(1)}×`,dur:900,final:'1.5–2×'},
      layer:{from:0.00,to:0.20,fmt:v=>`${v.toFixed(2)} mm`,dur:1100,final:'0.12–0.20 mm'},
      time:{from:0,to:24,fmt:v=>`${Math.round(v)} h`,dur:1100,final:'6–24 h'},
      infill:{from:0,to:20,fmt:v=>`${Math.round(v)}%`,dur:900,final:'10–20%'},
      walls:{from:0,to:3,fmt:v=>`${Math.round(v)}`,dur:900,final:'2–3'}
    };
    const lerp=(a,b,t)=>a+(b-a)*t;
    function countTo(el,spec){ const t0=performance.now(); function frame(t){ const k=Math.min(1,(t-t0)/spec.dur); el.textContent=spec.fmt(lerp(spec.from,spec.to,k)); if(k<1) requestAnimationFrame(frame); else if(spec.final) el.textContent=spec.final; el.style.opacity=1; el.style.transform='translateY(0) scale(1)'; } requestAnimationFrame(frame); }
    const ioNums=new IntersectionObserver(es=>{ es.forEach(e=>{ if(!e.isIntersecting) return; const n=e.target; const spec=mapTargets[n.getAttribute('data-kind')]; if(spec){countTo(n,spec);} ioNums.unobserve(n); }); },{threshold:.6});
    document.querySelectorAll('.num').forEach(n=>ioNums.observe(n));

    // reveal history steps
    const ioStep=new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); ioStep.unobserve(e.target);} }); },{threshold:.2});
    document.querySelectorAll('.step').forEach(s=>ioStep.observe(s));

    // Tabs (Types & Applications) with LOCAL IMAGES 1b–5b
    const TYPES=[
      { key:'Educational', img:'1b.png',
        uses:['High-detail 3D reliefs complement 2D maps','Clarify contour lines & geomorphology','Tactile reliefs for inclusive cartography'],
        note:'Makes abstract map concepts tangible and memorable.' },
      { key:'Planning & Engineering', img:'2b.png',
        uses:['Urban & hydraulic models for projects','Architecture / civil / landscape planning','Communicate designs to non-experts'],
        note:'Shows how infrastructure interacts with terrain.' },
      { key:'Museums & Culture', img:'4b.png',
        uses:['Educational exhibits that attract attention','Reconstruct historical events or landscapes','Examples: ETH Zürich, Bayerisches Nationalmuseum, Naturmuseum St. Gallen, Staatsbibliothek zu Berlin'],
        note:'Tangible storytelling that engages visitors.' },
      { key:'Military', img:'10.png',
        uses:['Terrain familiarity for strategy & planning','WWII: plastic reliefs for mission planning','Today: paired with digital simulation'],
        note:'Clear shared picture of the ground for coordination.' },
      { key:'Artistic & Aesthetic', img:'5b.png',
        uses:['Landscapes as art / film props / exhibitions','Replicas inspired by real terrains','Merges scientific data with visual culture'],
        note:'Science meets art in physical form.' }
    ];
    const tabs=document.getElementById('tabs'); const view=document.getElementById('tabview');
    function renderTab(i){
      [...tabs.children].forEach((b,idx)=>b.setAttribute('aria-selected',idx===i));
      const t=TYPES[i];
      view.innerHTML=`<figure style="margin:0"><img id="tabImg" src="${t.img}" alt="${t.key} example"></figure>
      <div><ul class="bullets">${t.uses.map(u=>`<li>${u}</li>`).join('')}</ul>
      <p style="color:var(--muted);margin:8px 0 0">${t.note}</p></div>`;
      const img = document.getElementById('tabImg');
      img?.addEventListener('click', ()=> openLightbox([t.img], 0));
    }
    TYPES.forEach((t,i)=>{ const b=document.createElement('button'); b.className='tab'; b.textContent=t.key; b.addEventListener('click',()=>renderTab(i)); tabs.appendChild(b); });
    renderTab(0);

    // Parallax background
    const layers=document.querySelectorAll('.parallax');
    addEventListener('scroll',()=>{ const y=scrollY||pageYOffset; let i=0; layers.forEach(el=>{ const d=(i++ + 1)*0.005; el.style.transform=`translateY(${y*d}px)`; }); },{passive:true});

    // timeline tracker fill
    (function(){
      const tl=document.getElementById('hist'); if(!tl) return;
      const fill=tl.querySelector('.fill');
      const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
      let ticking=false;
      function update(){
        const r=tl.getBoundingClientRect(), vh=innerHeight||document.documentElement.clientHeight, center=vh*0.35;
        const prog=clamp((center-r.top)/r.height,0,1);
        tl.style.setProperty('--prog',prog); tl.style.setProperty('--tlh',r.height+'px');
        if(fill) fill.style.height=(prog*r.height)+'px';
        ticking=false;
      }
      function onScroll(){ if(!ticking){ ticking=true; requestAnimationFrame(update);} }
      addEventListener('scroll',onScroll,{passive:true}); addEventListener('resize',onScroll); update();
    })();

    // Simple lightbox reused for tabs + 03 gallery
    const lb = (()=> {
      const root = document.createElement('div');
      root.className = 'lightbox';
      root.innerHTML = `
        <button class="lb-btn lb-close" aria-label="Close">✕</button>
        <img alt="">
        <div class="lb-nav">
          <button class="lb-btn" data-dir="-1">‹ Prev</button>
          <button class="lb-btn" data-dir="1">Next ›</button>
        </div>`;
      document.body.appendChild(root);
      const img = root.querySelector('img');
      const closeBtn = root.querySelector('.lb-close');
      const prevBtn = root.querySelector('[data-dir="-1"]');
      const nextBtn = root.querySelector('[data-dir="1"]');
      let list = [], idx = 0;

      function show(i){
        idx = (i+list.length)%list.length;
        img.src = list[idx];
        prevBtn.style.display = nextBtn.style.display = (list.length>1)?'inline-flex':'none';
      }
      function open(arr, start=0){ list = arr; show(start); root.classList.add('open'); }
      function close(){ root.classList.remove('open'); img.src=''; list=[]; }

      closeBtn.addEventListener('click', close);
      root.addEventListener('click', (e)=>{ if(e.target===root) close(); });
      prevBtn.addEventListener('click', ()=>show(idx-1));
      nextBtn.addEventListener('click', ()=>show(idx+1));
      addEventListener('keydown', (e)=>{ if(!root.classList.contains('open')) return;
        if(e.key==='Escape') close(); if(e.key==='ArrowLeft') show(idx-1); if(e.key==='ArrowRight') show(idx+1);
      });
      return { open };
    })();
    function openLightbox(arr, start=0){ lb.open(arr, start); }

    // Production Techniques gallery binding (3a–3i)
    (function(){
      const PT_LIST = ['3a.jpeg','3b.jpeg','3c.jpeg','3d.jpeg','3e.jpeg','3f.jpeg','3g.jpeg','3h.jpeg','3i.jpeg'];
      const wrap = document.getElementById('ptGallery');
      if(!wrap) return;
      wrap.querySelectorAll('.thumb').forEach((el, i) => {
        el.addEventListener('click', () => openLightbox(PT_LIST, i));
      });
    })();

    // workflow stepper highlight
    (function(){
      const stepper=document.getElementById('wfStepper'); if(!stepper) return;
      const nodes=[...stepper.querySelectorAll('.node')];
      const figs=[...document.querySelectorAll('#workflow figure')];
      function setActive(i){ nodes.forEach((n,idx)=>n.classList.toggle('active',idx===i)); }
      const obs=new IntersectionObserver(entries=>{
        entries.forEach(e=>{ if(e.isIntersecting){ const i=figs.indexOf(e.target); if(i>=0) setActive(i); }}); },{threshold:.6});
      figs.forEach(f=>obs.observe(f)); setActive(0);
    })();
  </script>
</body>
</html>
